第十一周: DNS、CDN和多活
---

## DNS
### 查询
- 递归查询
- 迭代查询：本地域名服务器和根域名服务器之间

### DNS配置
- 配置DNS server

### DNS问题
- DNS劫持
- 缓存老化
- DNS解析被转发，导致原IP变更可能影响按地理位置负载均衡的路由算法失效

### 高可用DNS设计
使用HTTPDNS

## CDN

### 作用
- 缓存代理： 通过智能DNS筛选，用户的请求被透明地指向最近的省内骨干节点，缩短用户信息的传输距离
- 路由加速
- 安全保护：攻击目标大都会被指向CDN，进而保护了后面的源站

- 内容路由
  - DNS系统: IP地理位置
  - 应用层重定向如HTTP 302
- 内容分发
  - PUSH: 主动分发，将内容分发到CND Cache节点
  - PULL：用户请求驱动，有可能缓存更新延迟，文件名使用内容的md
- 内容存储

### 静态CND加速
- 静态CDN域名非主域名
- PC端可使用多个域名，移动端尽量收敛域名个数
- 资源版本话管理，如用内容md hash

### 动态CND加速
- SSL Offload: 减少原服务器执行加解密的计算密集型任务的压力
- On-the-fly Compression: 离开源的时候就进行压缩
- 连接管理： 边界节点和源之间使用长连接，而非一个请求一个连接
- route optimization: 路由跳转优化
- TCP优化：bbr、fast TCP等
## 多活

### 系统选型
- 业务分级： 访问量、核心场景
- 数据分类：数据量、唯一性、实时性、可丢失性
- 数据同步：存储系统同步、消息队列同步
- 异常处理：同步延迟、数据丢失

### 资源分类
- global资源：主zone负责写，同步到其他zone，单写+多读
- multi zone资源：按用户维度sharding,多写+多读
- single zone资源：单机房
  
## reference